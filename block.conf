# UA拦截
if ($http_user_agent ~* "(micromessenger|QQ/)") {
    return 599;
}
    
error_page 599 @ua_block;
    
location @ua_block {
  default_type text/html;
    set $domain "$host";  # 自动获取当前域名
    return 200 '<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>安全访问提示</title><style>:root{--primary:#6366f1;--glass:rgba(255,255,255,0.95)}body{font-family:"Segoe UI",system-ui,sans-serif;background:linear-gradient(135deg,#e0e7ff 0%,#fae8ff 100%);min-height:100vh;margin:0;padding:20px;display:flex;align-items:center;justify-content:center}.card{background:var(--glass);backdrop-filter:blur(12px);border-radius:24px;padding:2rem;box-shadow:0 8px 32px rgba(31,38,135,0.15);max-width:480px;width:90%;border:1px solid rgba(255,255,255,0.3)}.title{color:var(--primary);font-size:1.8rem;margin:0 0 1.5rem;position:relative;padding-left:40px}.title::before{content:"🔒";position:absolute;left:0;top:-2px}.step{display:flex;align-items:center;padding:1.2rem;background:rgba(99,102,241,0.1);border-radius:12px;margin:1rem 0}.step-number{width:32px;height:32px;background:var(--primary);color:#fff;border-radius:8px;display:flex;align-items:center;justify-content:center;margin-right:1rem;flex-shrink:0}.copy-area{position:relative;margin:2rem 0;display:flex;gap:8px;width:100%}.url-input{flex:1;min-width:60px;padding:12px 16px;border:2px solid #e5e7eb;border-radius:12px;background:#fff;font-size:0.9rem;color:#374151;box-sizing:border-box;overflow:hidden;text-overflow:ellipsis}.copy-btn{flex-shrink:0;background:var(--primary);color:#fff;border:none;padding:8px 20px;border-radius:8px;cursor:pointer;transition:all 0.2s;white-space:nowrap}.copy-btn:hover{transform:scale(0.98);opacity:0.9}.platform-tips{display:grid;gap:1rem;margin-top:2rem}.device-tip{padding:1rem;background:rgba(99,102,241,0.08);border-radius:12px;display:flex;align-items:center}.device-icon{font-size:1.5rem;margin-right:1rem}@media (max-width:480px){.card{padding:1.5rem}.title{font-size:1.5rem}.copy-btn{padding:8px 12px}}</style></head><body><div class="card"><h1 class="title">社交内访问-功能受限</h1><div class="step"><div class="step-number">1</div><div><h3>方法一</h3><p style="color:#6b7280;margin-top:4px">点击右上角 <span style="color:var(--primary)">•••</span><br>选择浏览器自动跳转</p></div></div><div class="step"><div class="step-number">2</div><div><h3>方法二</h3><p style="color:#6b7280;margin-top:4px">点击下方复制链接<br>在浏览器自行打开</p></div></div><div class="copy-area"><input type="text" class="url-input" value="$domain" readonly><button class="copy-btn" onclick="copyUrl()">复制链接</button></div><div class="platform-tips"><div class="device-tip"><span class="device-icon">🍎</span><div><h4 style="margin:0">苹果设备</h4><p style="color:#6b7280;margin:4px 0 0">建议使用 Safari 浏览器</p></div></div><div class="device-tip"><span class="device-icon">🤖</span><div><h4 style="margin:0">安卓设备</h4><p style="color:#6b7280;margin:4px 0 0">使用任意浏览器</p></div></div></div></div><script>function copyUrl(){navigator.clipboard.writeText("$domain").then(()=>{showToast("😀链复制成功")}).catch(()=>{showToast("😂自复制失败，请手动复制")})}function showToast(message){const toast=document.createElement("div");toast.style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.8);color:white;padding:12px 24px;border-radius:8px;animation:fadeIn 0.3s";toast.textContent=message;document.body.appendChild(toast);setTimeout(()=>{toast.style.animation="fadeOut 0.3s";setTimeout(()=>toast.remove(),300)},2000)}</script></body></html>';
}
